groups:
  - name: disk_space
    interval: 60s
    rules:
      # System SSD disk space alerts
      - alert: SystemDiskSpaceWarning
        expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"}) * 100 < 25
        for: 5m
        labels:
          severity: warning
          component: system
        annotations:
          summary: "System disk space low"
          description: "System SSD {{ $labels.instance }} has {{ $value | humanizePercentage }} free space remaining (Warning threshold: <25%)"

      - alert: SystemDiskSpaceCritical
        expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"}) * 100 < 20
        for: 2m
        labels:
          severity: critical
          component: system
        annotations:
          summary: "CRITICAL: System disk space dangerously low"
          description: "System SSD {{ $labels.instance }} has only {{ $value | humanizePercentage }} free space. Immediate cleanup required!"

      # BTRFS pool space alerts
      - alert: BtrfsPoolSpaceWarning
        expr: (node_filesystem_avail_bytes{mountpoint="/mnt/btrfs-pool"} / node_filesystem_size_bytes{mountpoint="/mnt/btrfs-pool"}) * 100 < 20
        for: 10m
        labels:
          severity: warning
          component: storage
        annotations:
          summary: "BTRFS pool space low"
          description: "BTRFS pool {{ $labels.instance }} has {{ $value | humanizePercentage }} free space remaining (Warning threshold: <20%)"

      # Memory pressure alerts
      - alert: MemoryPressureHigh
        expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 90
        for: 5m
        labels:
          severity: warning
          component: system
        annotations:
          summary: "Memory pressure high"
          description: "System memory usage is {{ $value | humanizePercentage }}. May cause OOM kills."

      # Swap usage alerts
      - alert: SwapUsageHigh
        expr: (1 - (node_memory_SwapFree_bytes / node_memory_SwapTotal_bytes)) * 100 > 80
        for: 10m
        labels:
          severity: warning
          component: system
        annotations:
          summary: "Swap usage high ({{ $value | humanizePercentage }})"
          description: "System is swapping heavily ({{ $value | humanizePercentage }} used). Consider investigating memory pressure."

      # Swap thrashing (performance degradation indicator)
      - alert: SwapThrashing
        expr: rate(node_vmstat_pswpin[5m]) > 100 or rate(node_vmstat_pswpout[5m]) > 100
        for: 5m
        labels:
          severity: warning
          component: system
        annotations:
          summary: "System is swap thrashing"
          description: "High swap I/O detected ({{ $value }} pages/sec). Performance degradation likely."
