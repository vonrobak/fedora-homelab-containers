# Homelab Architecture - Visual Diagrams

## ğŸŒ Network Flow Diagram

```
                          INTERNET
                             â”‚
                             â”‚ DNS Query
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Cloudflare   â”‚ patriark.org â†’ 62.249.184.112
                    â”‚   DNS Server   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTPS Request
                             â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   ISP / Public IP      â”‚
                â”‚   62.249.184.112       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Port Forward
                             â”‚ :80 â†’ :80
                             â”‚ :443 â†’ :443
                             â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   UDM Pro Firewall     â”‚
                â”‚   192.168.1.1          â”‚
                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                â”‚   â”‚ Port Forwarding  â”‚ â”‚
                â”‚   â”‚ :80  â†’ .70:80    â”‚ â”‚
                â”‚   â”‚ :443 â†’ .70:443   â”‚ â”‚
                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Local Network
                             â”‚ 192.168.1.0/24
                             â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   fedora-htpc          â”‚
                â”‚   192.168.1.70         â”‚
                â”‚                        â”‚
                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                â”‚   â”‚   CrowdSec     â”‚   â”‚ â† Threat Check
                â”‚   â”‚   Layer        â”‚   â”‚   âœ“ Pass / âœ— Block 403
                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                â”‚           â”‚            â”‚
                â”‚           â†“            â”‚
                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                â”‚   â”‚    Traefik     â”‚   â”‚ â† Reverse Proxy
                â”‚   â”‚   :80 / :443   â”‚   â”‚   â€¢ SSL Termination
                â”‚   â”‚                â”‚   â”‚   â€¢ Rate Limiting
                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â€¢ Route Matching
                â”‚           â”‚            â”‚
                â”‚           â†“            â”‚
                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                â”‚   â”‚   Tinyauth     â”‚   â”‚ â† Authentication
                â”‚   â”‚   :3000        â”‚   â”‚   âœ“ Session / âœ— Login
                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                â”‚           â”‚            â”‚
                â”‚           â†“            â”‚
                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                â”‚   â”‚    Service     â”‚   â”‚ â† Application
                â”‚   â”‚  (Jellyfin)    â”‚   â”‚   Render Response
                â”‚   â”‚    :8096       â”‚   â”‚
                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
                        RESPONSE
```

---

## ğŸ” Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 7: APPLICATION AUTH                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Tinyauth SSO                                      â”‚  â”‚
â”‚  â”‚ â€¢ Session-based authentication                    â”‚  â”‚
â”‚  â”‚ â€¢ Bcrypt password hashing                         â”‚  â”‚
â”‚  â”‚ â€¢ Cookie management                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 6: RATE LIMITING                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Traefik Middleware                                â”‚  â”‚
â”‚  â”‚ â€¢ 100 requests/minute                             â”‚  â”‚
â”‚  â”‚ â€¢ Burst: 50 requests                              â”‚  â”‚
â”‚  â”‚ â€¢ Per-IP tracking                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 5: THREAT INTELLIGENCE                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ CrowdSec Bouncer                                  â”‚  â”‚
â”‚  â”‚ â€¢ Global IP reputation                            â”‚  â”‚
â”‚  â”‚ â€¢ Behavioral analysis                             â”‚  â”‚
â”‚  â”‚ â€¢ Community blocklists                            â”‚  â”‚
â”‚  â”‚ â€¢ Automatic banning                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 4: TLS ENCRYPTION                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Let's Encrypt Certificates                        â”‚  â”‚
â”‚  â”‚ â€¢ TLS 1.2+ only                                   â”‚  â”‚
â”‚  â”‚ â€¢ Strong ciphers                                  â”‚  â”‚
â”‚  â”‚ â€¢ Perfect forward secrecy                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 3: SECURITY HEADERS                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ HTTP Security Headers                             â”‚  â”‚
â”‚  â”‚ â€¢ X-Frame-Options: SAMEORIGIN                     â”‚  â”‚
â”‚  â”‚ â€¢ X-Content-Type-Options: nosniff                 â”‚  â”‚
â”‚  â”‚ â€¢ HSTS: max-age=31536000                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 2: PORT FILTERING                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ UDM Pro Firewall                                  â”‚  â”‚
â”‚  â”‚ â€¢ Only ports 80/443 exposed                       â”‚  â”‚
â”‚  â”‚ â€¢ Port forwarding rules                           â”‚  â”‚
â”‚  â”‚ â€¢ Stateful inspection                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 1: NETWORK ISOLATION                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Container Networks                                â”‚  â”‚
â”‚  â”‚ â€¢ Isolated bridge networks                        â”‚  â”‚
â”‚  â”‚ â€¢ No direct internet access                       â”‚  â”‚
â”‚  â”‚ â€¢ Traefik as only gateway                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ³ Container Network Topology

```
Host: fedora-htpc (192.168.1.70)
â”‚
â”œâ”€â”€â”€ systemd-reverse_proxy Network (10.89.2.0/24)
â”‚    â”‚
â”‚    â”œâ”€â”€â”€ traefik (10.89.2.x)
â”‚    â”‚    â”œâ”€ Port 80 â†’ Host:80
â”‚    â”‚    â”œâ”€ Port 443 â†’ Host:443
â”‚    â”‚    â””â”€ Port 8080 â†’ Host:8080
â”‚    â”‚
â”‚    â”œâ”€â”€â”€ crowdsec (10.89.2.x)
â”‚    â”‚    â””â”€ Port 8080 (internal only)
â”‚    â”‚
â”‚    â”œâ”€â”€â”€ tinyauth (10.89.2.x)
â”‚    â”‚    â””â”€ Port 3000 (internal only)
â”‚    â”‚
â”‚    â””â”€â”€â”€ jellyfin (10.89.2.x)
â”‚         â””â”€ Port 8096 (internal only)
â”‚
â””â”€â”€â”€ Host Network
     â”œâ”€ DNS: 192.168.1.69 (Pi-hole)
     â”œâ”€ Gateway: 192.168.1.1 (UDM Pro)
     â””â”€ Public IP: 62.249.184.112 (Dynamic)
```

---

## ğŸ“Š Data Flow: User Request

```
1. User enters URL
   https://jellyfin.patriark.org
   
2. DNS Resolution
   Browser â†’ Pi-hole (192.168.1.69) â†’ 192.168.1.70 (LAN)
   Browser â†’ Cloudflare â†’ 62.249.184.112 (WAN)
   
3. TLS Handshake
   Browser â†TLSâ†’ Traefik
   â€¢ Certificate validation (Let's Encrypt)
   â€¢ Encrypted connection established
   
4. HTTP Request Hits Traefik
   GET https://jellyfin.patriark.org/
   â”œâ”€ Load CrowdSec middleware
   â”‚  â””â”€ Check IP reputation
   â”‚     â”œâ”€ Banned? â†’ 403 Forbidden (STOP)
   â”‚     â””â”€ Clean? â†’ Continue
   â”œâ”€ Load Rate Limit middleware
   â”‚  â””â”€ Check request rate
   â”‚     â”œâ”€ Exceeded? â†’ 429 Too Many (STOP)
   â”‚     â””â”€ OK? â†’ Continue
   â”œâ”€ Load Tinyauth middleware
   â”‚  â””â”€ Check authentication
   â”‚     â”œâ”€ No session? â†’ 302 Redirect to auth.patriark.org
   â”‚     â””â”€ Valid session? â†’ Continue
   â””â”€ Route to service
      â””â”€ Forward to http://jellyfin:8096
      
5. Service Processes Request
   Jellyfin receives request
   â”œâ”€ Verify Jellyfin user session
   â”‚  â”œâ”€ No login? â†’ Show Jellyfin login
   â”‚  â””â”€ Logged in? â†’ Render content
   â””â”€ Return response
   
6. Response Returns
   Jellyfin â†’ Traefik â†’ TLS â†’ Browser
   
7. User Sees Content
   Page renders in browser
```

---

## ğŸ”„ Service Startup Order

```
Boot
 â”‚
 â”œâ”€â†’ System Services
 â”‚   â”œâ”€ Network
 â”‚   â”œâ”€ Podman
 â”‚   â””â”€ Systemd User Session
 â”‚
 â””â”€â†’ User Services (UID 1000)
     â”‚
     â”œâ”€â†’ [1] Networks Created
     â”‚   â””â”€ systemd-reverse_proxy
     â”‚
     â”œâ”€â†’ [2] CrowdSec
     â”‚   â”œâ”€ Load collections
     â”‚   â”œâ”€ Start LAPI
     â”‚   â””â”€ Ready to accept bouncers
     â”‚
     â”œâ”€â†’ [3] Tinyauth
     â”‚   â”œâ”€ Load configuration
     â”‚   â”œâ”€ Start HTTP server
     â”‚   â””â”€ Ready for auth requests
     â”‚
     â”œâ”€â†’ [4] Traefik
     â”‚   â”œâ”€ Load static config
     â”‚   â”œâ”€ Connect to Podman socket
     â”‚   â”œâ”€ Load dynamic configs
     â”‚   â”œâ”€ Initialize CrowdSec bouncer
     â”‚   â”œâ”€ Check SSL certificates
     â”‚   â””â”€ Start listening on :80/:443
     â”‚
     â””â”€â†’ [5] Application Services
         â”œâ”€ Jellyfin
         â””â”€ (Other services)
```

---

## ğŸ¯ Request Path: Authenticated Access

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚  Browser â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 1. https://jellyfin.patriark.org
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Traefik    â”‚ â† 2. No auth cookie
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 3. 302 Redirect
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tinyauth   â”‚ â† 4. Show login page
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 5. POST /login (credentials)
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tinyauth   â”‚ â† 6. Validate password
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 7. Set session cookie
      â”‚ 8. 302 Redirect back
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Traefik    â”‚ â† 9. Request with cookie
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 10. Verify with Tinyauth
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tinyauth   â”‚ â† 11. Validate session
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 12. Return: Valid
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Traefik    â”‚ â† 13. Forward to service
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 14. Proxy request
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Jellyfin   â”‚ â† 15. Process request
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 16. Return response
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚ â† 17. Content displayed
â”‚  Browser â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Service Dependencies

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Internet   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚  Cloudflare  â”‚
                    â”‚     DNS      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   UDM Pro    â”‚
                    â”‚   Firewall   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ Traefik  â”‚â—„â”€â”€â”€â”€â”€â”‚  CrowdSec  â”‚      â”‚ Tinyauth â”‚
   â”‚ (Gateway)â”‚      â”‚ (Security) â”‚      â”‚  (Auth)  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                                       â”‚
        â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚       â”‚         â”‚          â”‚
           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”   â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”‚
           â”‚Jellyfinâ”‚   â”‚    â”‚Next     â”‚    â”‚
           â”‚        â”‚   â”‚    â”‚cloud    â”‚    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                        â”‚                   â”‚
                   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                   â”‚ Future  â”‚         â”‚ Future  â”‚
                   â”‚Service 1â”‚         â”‚Service 2â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend:
â—„â”€â”€â”€â”€ = Depends on / Communicates with
```

---

## ğŸ—‚ï¸ Directory Structure Tree

```
/home/patriark/containers/
â”‚
â”œâ”€â”€ config/                          # Service configurations
â”‚   â”œâ”€â”€ traefik/
â”‚   â”‚   â”œâ”€â”€ traefik.yml             # Static configuration
â”‚   â”‚   â”œâ”€â”€ dynamic/                # Dynamic configurations
â”‚   â”‚   â”‚   â”œâ”€â”€ routers.yml         # Route definitions
â”‚   â”‚   â”‚   â”œâ”€â”€ middleware.yml      # Security & auth
â”‚   â”‚   â”‚   â”œâ”€â”€ tls.yml             # TLS options
â”‚   â”‚   â”‚   â””â”€â”€ rate-limit.yml      # Rate limiting rules
â”‚   â”‚   â”œâ”€â”€ letsencrypt/            # SSL certificates
â”‚   â”‚   â”‚   â””â”€â”€ acme.json           # Let's Encrypt data
â”‚   â”‚   â””â”€â”€ certs/                  # (deprecated)
â”‚   â”‚
â”‚   â”œâ”€â”€ crowdsec/                   # CrowdSec config (auto-generated)
â”‚   â”œâ”€â”€ jellyfin/                   # Jellyfin configuration
â”‚   â””â”€â”€ tinyauth/                   # (config via env vars)
â”‚
â”œâ”€â”€ data/                           # Persistent service data
â”‚   â”œâ”€â”€ crowdsec/
â”‚   â”‚   â”œâ”€â”€ db/                     # Decision database
â”‚   â”‚   â””â”€â”€ config/                 # Runtime config
â”‚   â”œâ”€â”€ jellyfin/                   # Media library metadata
â”‚   â””â”€â”€ nextcloud/                  # (to be created)
â”‚
â”œâ”€â”€ scripts/                        # Automation scripts
â”‚   â”œâ”€â”€ cloudflare-ddns.sh         # DNS updater - with cron or systemd (do not remember) jobs to update every 30 mins
â”‚   â”œâ”€â”€ security-audit.sh          # Security checker
â”‚   â””â”€â”€ health-check.sh            # System health
â”‚
â”œâ”€â”€ secrets/                        # Sensitive data (chmod 600)
â”‚   â”œâ”€â”€ cloudflare_token           # API token
â”‚   â””â”€â”€ cloudflare_zone_id         # Zone ID
â”‚
â”œâ”€â”€ backups/                        # Configuration backups
â”‚   â”œâ”€â”€ phase1-TIMESTAMP/          # Authelia migration backup
â”‚   â”œâ”€â”€ config-YYYYMMDD/           # Regular config backups
â”‚   â””â”€â”€ pre-change-TIMESTAMP/      # Pre-change snapshots
â”‚
â”œâ”€â”€ docs/                  # Documentation
â”œâ”€â”€     00-foundation/
â”‚Â Â      â”œâ”€â”€ day01-learnings.md
â”‚Â Â      â”œâ”€â”€ day02-networking.md
â”‚Â Â      â”œâ”€â”€ day03-pod-commands.md
â”‚Â Â      â”œâ”€â”€ day03-pods.md
â”‚Â Â      â”œâ”€â”€ day03-pods-vs-containers.md
â”‚Â Â      â””â”€â”€ podman-cheatsheet.md
â”œâ”€â”€     10-services/
â”‚Â Â      â”œâ”€â”€ day04-jellyfin-final.md
â”‚Â Â      â”œâ”€â”€ day06-complete.md
â”‚Â Â      â”œâ”€â”€ day06-quadlet-success.md
â”‚Â Â      â”œâ”€â”€ day06-traefik-routing.md
â”‚Â Â      â”œâ”€â”€ day07-yubikey-inventory.md
â”‚Â Â      â””â”€â”€ quadlets-vs-generated.md
â”œâ”€â”€     20-operations/
â”‚Â Â      â”œâ”€â”€ 20251023-storage_data_architecture_revised.md
â”‚Â Â      â”œâ”€â”€ DAILY-PROGRESS-2025-10-23.md
â”‚Â Â      â”œâ”€â”€ HOMELAB-ARCHITECTURE-DIAGRAMS.md
â”‚Â Â      â”œâ”€â”€ HOMELAB-ARCHITECTURE-DOCUMENTATION.md
â”‚Â Â      â”œâ”€â”€ NEXTCLOUD-INSTALLATION-GUIDE.md
â”‚Â Â      â”œâ”€â”€ QUICK-REFERENCE.md
â”‚Â Â      â”œâ”€â”€ readme-week02.md
â”‚Â Â      â”œâ”€â”€ storage-layout.md
â”‚Â Â      â””â”€â”€ TODAYS-ACHIEVEMENTS.md
â”œâ”€â”€     30-security/
â”‚Â Â      â””â”€â”€ TINYAUTH-GUIDE.md
â”œâ”€â”€     90-archive/
â”‚Â Â      â”œâ”€â”€ 20251024-storage_data_architecture-and-2fa-proposal.md
â”‚Â Â      â”œâ”€â”€ 2025-10-24-storage_data_architecture_tailored_addendum.md
â”‚Â Â      â”œâ”€â”€ checklist-week02.md
â”‚Â Â      â”œâ”€â”€ DOMAIN-CHANGE-SUMMARY.md
â”‚Â Â      â”œâ”€â”€ progress.md
â”‚Â Â      â”œâ”€â”€ quick-reference.bak-20251021-172023.md
â”‚Â Â      â”œâ”€â”€ quick-reference.bak-20251021-221915.md
â”‚Â Â      â”œâ”€â”€ quick-reference.md
â”‚Â Â      â”œâ”€â”€ quick-reference-v2.md
â”‚Â Â      â”œâ”€â”€ quick-start-guide-week02.md
â”‚Â Â      â”œâ”€â”€ readme.bak-20251021-172023.md
â”‚Â Â      â”œâ”€â”€ readme.bak-20251021-221915.md
â”‚Â Â      â”œâ”€â”€ readme.md
â”‚Â Â      â”œâ”€â”€ revised-learning-plan.md
â”‚Â Â      â”œâ”€â”€ SCRIPT-EXPLANATION.md
â”‚Â Â      â”œâ”€â”€ summary-revised.md
â”‚Â Â      â”œâ”€â”€ TOMORROW-QUICK-START.md
â”‚Â Â      â”œâ”€â”€ week02-failed-authelia-but-tinyauth-goat.md
â”‚Â Â      â”œâ”€â”€ week02-implementation-plan.md
â”‚Â Â      â””â”€â”€ week02-security-and-tls.md
â””â”€â”€ 99-reports/
        â”œâ”€â”€ 20251024-configurations-quadlets-and-more.md
        â”œâ”€â”€ 20251025-storage-architecture-authoritative.md
        â”œâ”€â”€ 20251025-storage-architecture-authoritative-rev2.md
        â”œâ”€â”€ authelia-diag-20251020-183321.txt
        â”œâ”€â”€ failed-authelia-adventures-of-week-02-current-state-of-system.md
        â”œâ”€â”€ homelab-diagnose-20251021-165859.txt
        â”œâ”€â”€ latest-summary.md
        â”œâ”€â”€ pre-letsencrypt-diag-20251022-161247.txt
        â”œâ”€â”€ script2-week2-authelia-dual-domain.md
        â””â”€â”€ system-state-20251022-213400.txt

/home/patriark/.config/containers/systemd/          # quadlet configuration directory
â”œâ”€â”€ auth_services.network           # podman bridge network - currently idle with no services
â”œâ”€â”€ crowdsec.container              # CrowdSec service definition
â”œâ”€â”€ jellyfin.container              # Jellyfin service definition
â”œâ”€â”€ media_services.network          # Media Services podman bridge network 
â”œâ”€â”€ reverse_proxy.network           # Reverse Proxy podman bridge network - members: all
â”œâ”€â”€ tinyauth.container              # Tinyauth service definition
â””â”€â”€ traefik.container               # Traefik service definition
```

---

## ğŸ”„ Update & Maintenance Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MONTHLY MAINTENANCE                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Create Backup  â”‚
                    â”‚ â€¢ BTRFS snap   â”‚
                    â”‚ â€¢ Config tar   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Update Check   â”‚
                    â”‚ podman auto-   â”‚
                    â”‚ update --dry   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Pull Updates   â”‚
                    â”‚ podman auto-   â”‚
                    â”‚ update         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Restart Svc    â”‚
                    â”‚ systemctl      â”‚
                    â”‚ restart *      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Test Services  â”‚
                    â”‚ â€¢ Check access â”‚
                    â”‚ â€¢ Check logs   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ All OK?        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 â”‚
                   Yes               No
                    â”‚                 â”‚
                    â†“                 â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Complete  â”‚     â”‚ Rollback     â”‚
            â”‚           â”‚     â”‚ BTRFS snap   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Service Addition Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ADD NEW SERVICE                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ 1. Research    â”‚
                   â”‚ â€¢ Find image   â”‚
                   â”‚ â€¢ Check ports  â”‚
                   â”‚ â€¢ Read docs    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ 2. Create Dir  â”‚
                   â”‚ mkdir config/  â”‚
                   â”‚ mkdir data/    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ 3. Quadlet     â”‚
                   â”‚ Write .containerâ”‚
                   â”‚ file           â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ 4. Traefik     â”‚
                   â”‚ Add router +   â”‚
                   â”‚ service        â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ 5. Start       â”‚
                   â”‚ systemctl      â”‚
                   â”‚ start service  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ 6. Test        â”‚
                   â”‚ â€¢ Check logs   â”‚
                   â”‚ â€¢ Test access  â”‚
                   â”‚ â€¢ Verify auth  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ 7. Document    â”‚
                   â”‚ Update docs    â”‚
                   â”‚ with new svc   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

This visual documentation complements the text documentation and provides clear diagrams for understanding the system architecture.
