# Homelab Intelligence System

AI-powered intelligence layer for proactive homelab monitoring and optimization.

## Overview

The Intelligence System analyzes multiple homelab snapshots over time to detect trends, predict capacity issues, and recommend optimizations - transforming reactive monitoring into proactive infrastructure management.

## Components

### Core Library
- **`lib/snapshot-parser.sh`**: Shared functions for parsing snapshot JSON, extracting metrics, and statistical analysis

### Intelligence Tools
- **`simple-trend-report.sh`**: Quick intelligence report showing key trends (use this!)
- **`analyze-trends.sh`**: Comprehensive trend analysis (under development - has syntax issues, use simple version for now)

## Quick Start

### Generate Intelligence Report

```bash
./scripts/intelligence/simple-trend-report.sh
```

### Example Output

```markdown
# Homelab Intelligence Report

Generated: 2025-11-09 22:45:22
Snapshots analyzed: 8
Period: 2025-11-09 16:39:03 to 2025-11-09 22:38:25

## System Memory Trend
- Start: 14477MB
- Current: 13501MB
- Change: -976MB

## System Disk Trend
- Start: 67GB
- Current: 69GB / 118GB
- Growth: 2GB
```

## What It Analyzes

### Current Capabilities (simple-trend-report.sh)

1. **System Memory Trends**
   - Memory usage changes over time
   - Detects significant increases (>100MB warning)

2. **System Disk Trends**
   - Disk growth tracking
   - Warns when usage exceeds 75%

3. **BTRFS Pool Trends**
   - Storage pool growth rate
   - Capacity monitoring

4. **Service Health Status**
   - Counts healthy vs unhealthy services
   - Immediate alert if services are unhealthy

5. **Top Memory Consumers**
   - Identifies services using most memory
   - (Note: Currently requires snapshot script enhancement)

### Planned Capabilities (analyze-trends.sh - under development)

1. **Predictive Capacity Planning**
   - "System SSD will reach 80% in 14 days"
   - "Memory trending toward OOM in 7 days"

2. **Performance Regression Detection**
   - Service startup time degradation
   - Health check response time trends

3. **Resource Optimization Recommendations**
   - "Service X allocated 4GB, only uses 800MB â†’ reduce to 2GB"
   - Right-sizing suggestions

4. **Anomaly Detection**
   - Unusual restart patterns
   - Sudden memory/disk changes

## Usage Patterns

### Daily Intelligence Check

```bash
# Add to cron or run manually
./scripts/intelligence/simple-trend-report.sh > docs/99-reports/intelligence-$(date +%Y%m%d).md
```

### After Deployments

```bash
# Before deployment
./scripts/homelab-snapshot.sh

# Deploy services...

# After deployment
./scripts/homelab-snapshot.sh
./scripts/intelligence/simple-trend-report.sh
```

### Troubleshooting

```bash
# Check for issues
./scripts/intelligence/simple-trend-report.sh | grep -i warning

# Investigate specific service
jq '.services["servicename"]' docs/99-reports/snapshot-*.json | tail -5
```

## Technical Details

### Snapshot Requirements

- Minimum: 2 valid snapshots
- Recommended: 5+ snapshots for reliable trends
- Invalid/corrupted snapshots are automatically filtered out

### Data Sources

All data comes from `docs/99-reports/snapshot-*.json` files generated by `homelab-snapshot.sh`.

### Statistical Methods

- **Trend Analysis**: Linear regression on time-series data
- **Change Detection**: First vs last value comparison
- **Prediction**: Extrapolation based on slope

## Development Status

### âœ… Completed (Working)
- Snapshot parser library with 30+ functions
- Simple trend report (production-ready)
- Automatic invalid snapshot filtering
- Basic trend analysis for memory, disk, storage
- Service health status reporting

### ðŸš§ In Progress
- Complex trend analyzer (syntax issues being resolved)
- Per-service memory analysis (needs snapshot script enhancement)

### ðŸ“‹ Planned
- Dependency graph visualization
- Automated recommendation engine
- Alert integration (Discord notifications for predictions)
- JSON output format
- Historical trend comparison (week-over-week)

## Integration

### With homelab-snapshot.sh

The intelligence system reads snapshot JSON files. Run snapshots regularly:

```bash
# Manual
./scripts/homelab-snapshot.sh

# Automated (add to crontab)
0 */4 * * * ~/containers/scripts/homelab-snapshot.sh
```

### With Monitoring Stack

Future: Intelligence predictions can trigger Prometheus alerts:
- Disk capacity warnings
- Memory exhaustion predictions
- Service degradation detection

## Troubleshooting

### No snapshots found

```bash
# Check snapshot directory
ls -lh docs/99-reports/snapshot-*.json

# Generate snapshot
./scripts/homelab-snapshot.sh
```

### Invalid JSON errors

```bash
# Check which snapshots are valid
for f in docs/99-reports/snapshot-*.json; do
    jq '.' "$f" &>/dev/null && echo "âœ“ $f" || echo "âœ— $f INVALID"
done

# Remove invalid snapshots (optional)
# rm docs/99-reports/snapshot-YYYYMMDD-HHMMSS.json
```

### Empty output sections

Some features require enhanced snapshot data collection. Top Memory Consumers currently shows empty because `memory_mb` is not collected per-service in snapshots.

## Philosophy

**Proactive > Reactive**

Traditional monitoring tells you when things break. Intelligence tells you when things *will* break and what to do about it.

**Data-Driven Decisions**

Every recommendation is backed by statistical analysis of real system behavior, not guesses.

**Force Multiplier**

Built once, this system provides ongoing value forever - analyzing patterns you'd never notice manually.

## Examples

### Detecting Capacity Issues

```markdown
## System Disk Trend
- Current: 95GB / 118GB
- Growth: 15GB
- **Warning**: Disk usage above 75%
```

â†’ **Action**: Review log retention, clean up temporary files

### Tracking Service Health

```markdown
## Service Health Status
- Unhealthy: 2
- **Action Required**: Investigate unhealthy services
```

â†’ **Action**: Check `podman logs` for failed services

### Memory Optimization

```markdown
## System Memory Trend
- Change: -976MB
```

â†’ **Insight**: Phase 1 resource limits working - memory usage decreased after optimization

## Future Enhancements

1. **Machine Learning Integration**
   - Anomaly detection using historical patterns
   - Predictive failure analysis

2. **Automated Actions**
   - Auto-cleanup when disk thresholds approached
   - Service restart suggestions

3. **Comparative Analysis**
   - "Your disk usage is growing 2x faster than last week"
   - "Service X memory increased 40% since last month"

4. **Visualization**
   - ASCII charts in reports
   - Grafana dashboard integration
   - Trend graphs

## Contributing

The intelligence system is designed to be extensible. To add new analysis:

1. Add extraction function to `lib/snapshot-parser.sh`
2. Create analysis logic in your tool
3. Test with real snapshots
4. Document in README

## License

Part of the fedora-homelab-containers project.

---

**Built with:** Bash, jq, bc, statistical analysis
**Status:** Production-ready (simple report), Active development (complex analyzer)
**Impact:** Force multiplier for homelab management
